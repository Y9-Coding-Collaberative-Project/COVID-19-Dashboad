<html>
   
    <head>
        
        <title>Fill This In</title>
        
        <link rel="stylesheet" href="stylz.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel='stylesheet' href='https://unpkg.com/leaflet@1.4.0/dist/leaflet.css'/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src='latest_data.json'></script>
        <!-- <script src='data.js'></script> -->
        <script src='https://unpkg.com/leaflet@1.4.0/dist/leaflet.js'></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
        <script src="https://mdjhoel.github.io/Y9_19/clookup.json"></script>
        
        <style>
        </style>

    </head>
    
    <body>
        
        <div class="navbar">
            <a class="main" href="index.html">Home</a>
            <a href="about_us.html">About us</a>
            <a href="abou_virus.html">What can we do?</a>
            <a href="fun.html">Fun</a>
        </div>
        
        <div class="content">
            <p>Everything Important Here</p>
            <input type="file" id="upload">
            <h1 id = date></h1>
            <div id='map' style='width:100%; height:500'></div>
            <div id="countries"></div>
        </div>
            
        <div class="footer">
            <p id="demo"></p>
        </div>

    </body>
    
    <script>

        map()
        footer()
        
        function map() {
            map = new L.Map('map'); // creates a map at HTML div called "map"
            var cartocdn = "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png";
            cartoAttrib = "Carto geodatabase is good for this application"; // ???
            carto = new L.TileLayer(cartocdn);
            map.setView([51.5, 0.12],2); // centered on London lat, long
            map.addLayer(carto);
        }
    
        axios.get("https://api.covid19api.com/summary")
            .then(response => {
                document.getElementById("date").innerHTML = "COVID-19 Confirmed Cases (Latest Update: " + response.data['Date'] + ")"; // displays time of last update in HTML element called "date"
                parseData(response.data); // runs parseData with the new data
            })
            .catch(error => {
                console.log(error); // debugging data
            })
        
        function parseData(response) {
            console.log(response);
            console.log("Hello World");
            data = response;
            allvalues = Object.values(data['Countries']);
            for (i = 0; i < allvalues.length; i++) {
                shortcode = allvalues[i]['CountryCode'].toLowerCase(); // converts country code into lowercase to get coordinates (second data set uses a lowercase code)
                if (countries[shortcode] != undefined) { // prevents error by only looping if its not undefined
                    a = countries[shortcode][0]; // gets latitude
                    b = countries[shortcode][1]; // gets longitude
                    c = allvalues[i]['TotalConfirmed'];
                    d = allvalues[i]['Country'];
                    if (c > 0) { // only draws circle if there are any confirmed cases
                        L.circle([a,b],{color:'red',fillColor:'#f03',fillOpacity:0.5,radius:c}).addTo(map).bindPopup("'" + d + " : " + c + "'"); // draws circle with the variables as arguments
                    }
                }
            }
        }

        function footer() {
            var x = document.lastModified;
            document.getElementById("demo").innerHTML = "Last Refreshed " + x;            
        }

    </script>

</html>