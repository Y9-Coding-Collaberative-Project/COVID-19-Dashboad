<html lang="en-US">
   
    <head>
        
        <title>Fill This In</title>
        
        <link rel="stylesheet" href="stylz.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel='stylesheet' href='https://unpkg.com/leaflet@1.4.0/dist/leaflet.css'/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
        <script src='https://unpkg.com/leaflet@1.4.0/dist/leaflet.js'></script>
        <script src="https://mdjhoel.github.io/Y9_19/clookup.json"></script>
        <script src="https://www.gstatic.com/charts/loader.js"></script>
        
        <style>
            
            .columns {
                float: left;
                padding: 8px;
                height: 90%;
            }

            #left_column {
                width: 18.75%;
                background-color: #ff8c78;
                color: #333333;
            }

            #middle_column {
                width: 50%;
                background-color:#750000;
                color: white;
            }

            #right_column {
                width: 31.25%;
                background-color:#ff0000;
                color: white;
            }

            .indent{
                margin-left: 25px;
            }

            .step1 {
                position: relative;
                display: inline-block;
            }

            #find {
                border: 1px solid transparent;
                padding: 5px;
                width: 75%;
                height: 35px;
                font-size: 16px;
                background-color: #e9e8e8;
            }

            #submit {
                border: 1px solid transparent;
                padding: 5px;
                width: 25%;
                height: 35px;
                font-size: 16px;
                background-color: crimson;
                color: #fff;
                cursor: pointer;
                transition: transform 0.3s;
            }

            #submit:hover {
                background-color:orangered;
                box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);
  
            }

            .step1-items {
                position: absolute;
                border: 1px solid #d4d4d4;
                border-bottom: none;
                border-top: none;
                z-index: 99;
                /* position the autocomp lete items to be the same width as the container: */
                top: 100%;
                left: 0;
                right: 0;
            }

            .step1-items div {
                padding: 10px;
                cursor: pointer;
                background-color: #fff; 
                border-bottom: 1px solid #d4d4d4; 
            }

            /* when hovering an item: */
            .step1-items div:hover {
                background-color: #e9e9e9; 
            }

            /* when navigating through the items using the arrow keys: */
            .step1-active {
                background-color: DodgerBlue !important; 
                color: #ffffff; 
            }

        </style>

    </head>
    
    <body>
        
        <div class="navbar">
            <a class="main" href="index.html">Home</a>
            <a href="about_us.html">About us</a>
            <a href="about_virus.html">What can we do?</a>
            <a href="fun.html">Fun</a>
        </div>
        
        <div class="content">

            <div class="columns" id="left_column">
                <div class="step1">
                    <h1>Find The Stats For Your Country</h1>
                    <input id="find" type="text" placeholder="Start Typing A Country"><button id="submit" onclick="country()">Enter</button>
                </div>
                <p id="answer"></p>
            </div>

            <div class="columns" id="middle_column">
                <h1 id="date"></h1>
                <div id="map" style='width: 100%; height: 300;'></div>
                <br>
                <form id="select">
                    <input type="checkbox" name="type" id="active" onchange="#"> Active Cases<br>
                    <input type="checkbox" name="type" id="closed" onchange="all1()"> Closed Cases<br>
                    <input type="checkbox" name="type" class="indent" id="deaths" onchange="part1()"> Deaths<br>
                    <input type="checkbox" name="type" class="indent" id="recoveries" onchange="part1()"> Recoveries<br>
                    <input type="checkbox" name="type" id="new" onchange="all2()"> New Cases<br>
                    <input type="checkbox" name="type" class="indent" id="new_confirmed" onchange="part2()"> New Confirmed<br>
                    <input type="checkbox" name="type" class="indent" id="new_deaths" onchange="part2()"> New Deaths<br>
                    <input type="checkbox" name="type" class="indent" id="new_recoveries" onchange="part2()"> New Recoveries<br>
                    <input type="checkbox" name="type" id="total" onchange="api()"> Total Confirmed Cases<br>
                </form>
            </div>

            <div class="columns" id="right_column">
                <h1>General Global Stats</h1>
                <div id="piechart"></div>
            </div>
            
        </div>
            
        <div class="footer">
            <p id="demo"></p>
        </div>

    </body>
    
    <script type="text/javascript">

        var places = [];
        var global = [];

        setMap();
        api();
        autocomplete(document.getElementById("find"), places);
        keybind();
        footer();
        
        function setMap() {
            map = new L.Map("map"); // creates a map at HTML div called "map"
            var cartocdn = "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png";
            cartoAttrib = "Carto geodatabase is good for this application"; // ???
            carto = new L.TileLayer(cartocdn);
            map.setView([51.5, 0.12],2); // centered on London lat, long
            map.addLayer(carto);
        }
    
        function api() {
            axios.get("https://api.covid19api.com/summary")
                .then(response => {
                    document.getElementById("date").innerHTML = "COVID-19 Confirmed Cases (Latest Update: " + response.data['Date'] + ")"; // displays time of last update in HTML element called "date"
                    defaultdata(response.data); // runs parseData with the new data
                })
                .catch(error => {
                    console.log(error); // debugging data
                })
        }
        
        function defaultdata(response) {
            console.log(response);
            console.log("Hello World");
            data = response;
            global = Object.values(data['Global'])
            allvalues = Object.values(data['Countries']);
            map.eachLayer(function (layer) {
                map.removeLayer(layer);
            })
            // setMap()
            for (i = 0; i < allvalues.length; i++) {
                shortcode = allvalues[i]['CountryCode'].toLowerCase(); // converts country code into lowercase to get coordinates (second data set uses a lowercase code)
                a = allvalues[i]['Country'];
                b = allvalues[i]['TotalConfirmed'];
                c = allvalues[i]['TotalDeaths'];
                d = allvalues[i]['TotalRecovered'];
                e = allvalues[i]['NewConfirmed'];
                f = allvalues[i]['NewDeaths'];
                g = allvalues[i]['NewRecovered'];
                places.push(a)
                if (countries[shortcode] != undefined) { // prevents error by only looping if its not undefined and only draws circles if there are any cases in the current country
                    latitude = countries[shortcode][0]; // gets latitude
                    longitude = countries[shortcode][1]; // gets longitude
                    if (document.getElementById("total").checked == true && b > 0) {
                        L.circle([latitude,longitude],{color:'red',fillColor:'#f03',fillOpacity:0.5,radius:b}).addTo(map).bindPopup("'" + a + " : " + b + "'"); // draws circle with the variables as arguments
                    }
                }
            }
            console.log(places)
        }
        
        function autocomplete(inp, arr) {
            // the autocomplete function takes two arguments, the text field element and an array of possible autocompleted values
            var currentFocus;
            // execute a function when someone writes in the text field:
            inp.addEventListener("input", function(e) {
                var a, b, i, val = this.value;
                // close any already open lists of autocompleted values
                closeAllLists();
                if (!val) { return false;}
                currentFocus = -1;
                // create a DIV element that will contain the items (values):
                a = document.createElement("DIV");
                a.setAttribute("id", this.id + "step1-list");
                a.setAttribute("class", "step1-items");
                // append the DIV element as a child of the autocomplete container:
                this.parentNode.appendChild(a);
                //for each item in the array...
                for (i = 0; i < arr.length; i++) {
                    // check if the item starts with the same letters as the text field value:
                    if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                    // create a DIV element for each matching element:
                    b = document.createElement("DIV");
                    // make the matching letters bold:
                    b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                    b.innerHTML += arr[i].substr(val.length);
                    // insert a input field that will hold the current array item's value:
                    b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                    // execute a function when someone clicks on the item value (DIV element):
                    b.addEventListener("click", function(e) {
                        // insert the value for the autocomplete text field:
                        inp.value = this.getElementsByTagName("input")[0].value;
                        // close the list of autocompleted values, or any other open lists of autocompleted values:
                        closeAllLists();
                    });
                    a.appendChild(b);
                    }
                }
            });
            //execute a function presses a key on the keyboard:
            inp.addEventListener("keydown", function(e) {
                var x = document.getElementById(this.id + "step1-list");
                if (x) x = x.getElementsByTagName("div");
                if (e.keyCode == 40) {
                    // If the arrow DOWN key is pressed, increase the currentFocus variable:
                    currentFocus++;
                    // and and make the current item more visible:
                    addActive(x);
                } else if (e.keyCode == 38) { //up
                    // If the arrow UP key is pressed, decrease the currentFocus variable:
                    currentFocus--;
                    // and and make the current item more visible:
                    addActive(x);
                } else if (e.keyCode == 13) {
                    // If the ENTER key is pressed, prevent the form from being submitted,
                    e.preventDefault();
                    if (currentFocus > -1) {
                    // and simulate a click on the "active" item:
                    if (x) x[currentFocus].click();
                    }
                }
            });
            function addActive(x) {
                // a function to classify an item as "active":
                if (!x) return false;
                // start by removing the "active" class on all items:
                removeActive(x);
                if (currentFocus >= x.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = (x.length - 1);
                // add class "step1-active":
                x[currentFocus].classList.add("step1-active");
            }
            function removeActive(x) {
                // a function to remove the "active" class from all autocomplete items:
                for (var i = 0; i < x.length; i++) {
                x[i].classList.remove("step1-active");
                }
            }
            function closeAllLists(elmnt) {
                // close all autocomplete lists in the document, except the one passed as an argument:
                var x = document.getElementsByClassName("step1-items");
                for (var i = 0; i < x.length; i++) {
                if (elmnt != x[i] && elmnt != inp) {
                    x[i].parentNode.removeChild(x[i]);
                }
                }
            }
            // execute a function when someone clicks in the document:
            document.addEventListener("click", function (e) {
                closeAllLists(e.target);
        });
        }

        function keybind() {
            var input = document.getElementById("find");
            input.addEventListener("keyup", function(event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    document.getElementById("submit").click();
                }
            });
        }

        function country() {
            correct = document.getElementById("find").value
            console.log(correct)
            for (i = 0; i < allvalues.length; i++) {
                if (allvalues[i]['Country'] == correct) {
                    console.log(allvalues[i]);
                    document.getElementById("answer").innerHTML = "Total Confirmed Cases: " + allvalues[i]['TotalConfirmed'] + "<br>Deaths: " + allvalues[i]['TotalDeaths'] + "<br>Recoveries: " + allvalues[i]['TotalRecovered'] + "<br>New Confirmed: " + allvalues[i]['NewConfirmed'] + "<br>New Deaths: " + allvalues[i]['NewDeaths'] + "<br>New Recoveries: " + allvalues[i]['NewRecovered'];
                }
            }
        }

        function all1() {
            if (document.getElementById("closed").checked == true) {
                document.getElementById("deaths").checked = true;
                document.getElementById("recoveries").checked = true;
            } else {
                document.getElementById("deaths").checked = false;
                document.getElementById("recoveries").checked = false;
            }
        }

        function part1() {
            if (document.getElementById("deaths").checked == true && document.getElementById("recoveries").checked == true) {
                document.getElementById("closed").checked = true;
                document.getElementById("closed").indeterminate = false;
            } else if (document.getElementById("deaths").checked != true && document.getElementById("recoveries").checked != true) {
                document.getElementById("closed").checked = false;
                document.getElementById("closed").indeterminate = false;
            } else {
                document.getElementById("closed").checked = false;
                document.getElementById("closed").indeterminate = true;
            }
        }

        function all2() {
            if (document.getElementById("new").checked == true) {
                document.getElementById("new_confirmed").checked = true;
                document.getElementById("new_deaths").checked = true;
                document.getElementById("new_recoveries").checked = true;
            } else {
                document.getElementById("new_confirmed").checked = false;
                document.getElementById("new_deaths").checked = false;
                document.getElementById("new_recoveries").checked = false;
            }
        }

        function part2() {
            if (document.getElementById("new_confirmed").checked == true && document.getElementById("new_deaths").checked == true && document.getElementById("new_recoveries").checked == true) {
                document.getElementById("new").checked = true;
                document.getElementById("new").indeterminate = false;
            } else if (document.getElementById("new_confirmed").checked != true && document.getElementById("new_deaths").checked != true && document.getElementById("new_recoveries").checked != true) {
                document.getElementById("new").checked = false;
                document.getElementById("new").indeterminate = false;
            } else {
                document.getElementById("new").checked = false;
                document.getElementById("new").indeterminate = true;
            }
        }

        // function drawbarh() {
        //     var c = document.getElementById("BarH");
        //     var ctx = c.getContext("2d");
        //     c.width = 1020;
        //     c.height = (10 + graph.length * 60);
        //     for (i = 0; i < graph.length; i ++) {
        //         var a = (10 + i * 60);
        //         var b = (40 + i * 60);
        //         ctx.fillStyle = colors[i];
        //         ctx.fillRect(10,a,graph[i]*10,50);
        //         ctx.fillStyle = "white"
        //         ctx.fillText(text[i], 20, b);
        //     }
        // }

        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);
        
        function drawChart() {
            total = global[1]
            active = global[1] - global[3] - global[5]
            console.log(active)
            var graph = google.visualization.arrayToDataTable([
                ['Type', 'Amount'],
                ['Active', active],
                ['Dead', global[3]],
                ['Recovered', global[5]],
            ]);
            // Optional; add a title and set the width and height of the chart
            var options = {'title':'Confirmed Cases By Status Worldwide (' + total + ' Total)'};
            // Display the chart inside the <div> element with id="piechart"
            var chart = new google.visualization.PieChart(document.getElementById('piechart'));
            chart.draw(graph, options);
        }

        function footer() {
            var x = document.lastModified;
            document.getElementById("demo").innerHTML = "Last Refreshed " + x;            
        }

    </script>

</html>