<html>
   
    <head>
        
        <title>Fill This In</title>
        
        <link rel="stylesheet" href="stylz.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel='stylesheet' href='https://unpkg.com/leaflet@1.4.0/dist/leaflet.css'/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src='latest_data.json'></script>
        <!-- <script src='data.js'></script> -->
        <script src='https://unpkg.com/leaflet@1.4.0/dist/leaflet.js'></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
        <script src="https://mdjhoel.github.io/Y9_19/clookup.json"></script>
        
        <style>
            .indent{
                margin-left: 25px;
            }
        </style>

    </head>
    
    <body>
        
        <div class="navbar">
            <a class="main" href="index.html">Home</a>
            <a href="about_us.html">About us</a>
            <a href="abou_virus.html">What can we do?</a>
            <a href="fun.html">Fun</a>
        </div>
        
        <div class="content">
            <form id="select">
                <input type="checkbox" name="type" id="active" onchange="check()"> Active Cases<br>
                <input type="checkbox" name="type" id="closed" onchange="all1()"> Closed Cases<br>
                <input type="checkbox" name="type" class="indent" id="deaths" onchange="part1()"> Deaths<br>
                <input type="checkbox" name="type" class="indent" id="recoveries" onchange="part1()"> Recoveries<br>
                <input type="checkbox" name="type" id="new" onchange="all2()"> New Cases<br>
                <input type="checkbox" name="type" class="indent" id="new_confirmed" onchange="part2()"> New Confirmed<br>
                <input type="checkbox" name="type" class="indent" id="new_deaths" onchange="part2()"> New Deaths<br>
                <input type="checkbox" name="type" class="indent" id="new_recoveries" onchange="part2()"> New Recoveries<br>
                <input type="checkbox" name="type" id="total" onchange="check()"> Total Confirmed Cases<br>
                <input type="checkbox" name="type" id="showall" onchange="check()"> Show All
            </form>
            <h1 id="date"></h1>
            <div id="map" style='width:100%; height:500'></div>
        </div>
            
        <div class="footer">
            <p id="demo"></p>
        </div>

    </body>
    
    <script>

        map()
        api()
        footer()
        
        function map() {
            map = new L.Map("map"); // creates a map at HTML div called "map"
            var cartocdn = "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png";
            cartoAttrib = "Carto geodatabase is good for this application"; // ???
            carto = new L.TileLayer(cartocdn);
            map.setView([51.5, 0.12],2); // centered on London lat, long
            map.addLayer(carto);
        }
    
        function api() {
            axios.get("https://api.covid19api.com/summary")
                .then(response => {
                    document.getElementById("date").innerHTML = "COVID-19 Confirmed Cases (Latest Update: " + response.data['Date'] + ")"; // displays time of last update in HTML element called "date"
                    defaultdata(response.data); // runs parseData with the new data
                })
                .catch(error => {
                    console.log(error); // debugging data
                })
        }
        
        function defaultdata(response) {
            console.log(response);
            console.log("Hello World");
            data = response;
            allvalues = Object.values(data['Countries']);
            for (i = 0; i < allvalues.length; i++) {
                shortcode = allvalues[i]['CountryCode'].toLowerCase(); // converts country code into lowercase to get coordinates (second data set uses a lowercase code)
                if (countries[shortcode] != undefined) { // prevents error by only looping if its not undefined
                    a = countries[shortcode][0]; // gets latitude
                    b = countries[shortcode][1]; // gets longitude
                    c = allvalues[i]['TotalConfirmed'];
                    d = allvalues[i]['Country'];
                    if (c > 0) { // only draws circle if there are any confirmed cases
                        L.circle([a,b],{color:'red',fillColor:'#f03',fillOpacity:0.5,radius:c}).addTo(map).bindPopup("'" + d + " : " + c + "'"); // draws circle with the variables as arguments
                    }
                }
            }
        } 

        function all1() {
            if (document.getElementById("closed").checked == true) {
                document.getElementById("deaths").checked = true
                document.getElementById("recoveries").checked = true
            } else {
                document.getElementById("deaths").checked = false
                document.getElementById("recoveries").checked = false
            }
        }

        function part1() {
            if (document.getElementById("deaths").checked == true && document.getElementById("recoveries").checked == true) {
                document.getElementById("closed").checked = true
                document.getElementById("closed").indeterminate = false
            } else if (document.getElementById("deaths").checked != true && document.getElementById("recoveries").checked != true) {
                document.getElementById("closed").checked = false
                document.getElementById("closed").indeterminate = false
            } else {
                document.getElementById("closed").checked = false
                document.getElementById("closed").indeterminate = true
            }
        }

        function all2() {
            if (document.getElementById("new").checked == true) {
                document.getElementById("new_confirmed").checked = true
                document.getElementById("new_deaths").checked = true
                document.getElementById("new_recoveries").checked = true
            } else {
                document.getElementById("new_confirmed").checked = false
                document.getElementById("new_deaths").checked = false
                document.getElementById("new_recoveries").checked = false
            }
        }

        function part2() {
            if (document.getElementById("new_confirmed").checked == true && document.getElementById("new_deaths").checked == true && document.getElementById("new_recoveries").checked == true) {
                document.getElementById("new").checked = true
                document.getElementById("new").indeterminate = false
            } else if (document.getElementById("new_confirmed").checked != true && document.getElementById("new_deaths").checked != true && document.getElementById("new_recoveries").checked != true) {
                document.getElementById("new").checked = false
                document.getElementById("new").indeterminate = false
            } else {
                document.getElementById("new").checked = false
                document.getElementById("new").indeterminate = true
            }
        }

        // function drawbarh() {
        //     var c = document.getElementById("BarH");
        //     var ctx = c.getContext("2d");
        //     c.width = 1020;
        //     c.height = (10 + graph.length * 60);
        //     for (i = 0; i < graph.length; i ++) {
        //         var a = (10 + i * 60);
        //         var b = (40 + i * 60);
        //         ctx.fillStyle = colors[i];
        //         ctx.fillRect(10,a,graph[i]*10,50);
        //         ctx.fillStyle = "white"
        //         ctx.fillText(text[i], 20, b);
        //     }
        // }

        function footer() {
            var x = document.lastModified;
            document.getElementById("demo").innerHTML = "Last Refreshed " + x;            
        }

    </script>

</html>